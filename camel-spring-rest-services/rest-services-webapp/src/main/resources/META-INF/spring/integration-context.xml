<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
           http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">


    <camelContext id="camel-context-integration" xmlns="http://camel.apache.org/schema/spring">

        <routeContextRef ref="login-routes"/>
        <routeContextRef ref="user-routes-resolver"/>
        <routeContextRef ref="session-management-routes"/>
        <routeContextRef ref="registration-routes"/>
        <routeContextRef ref="database-routes"/>
        <routeContextRef ref="audit-routes"/>

        <onException>
            <exception>org.springframework.security.core.AuthenticationException</exception>
            <!--<handled>
                <simple>true</simple>
            </handled>
            -->
            <setBody>
                <constant>Internal server Error</constant>
            </setBody>
            <log message="Handled here login" loggingLevel="ERROR"/>
            <setHeader name="CamelHttpResponseCode">
                <constant>401</constant>
            </setHeader>
        </onException>

        <onException>
            <exception>java.lang.Exception</exception>
            <!--<handled>
                <simple>true</simple>
            </handled>
            -->
            <setBody>
                <constant>Internal server Error</constant>
            </setBody>
            <log message="Handled here" loggingLevel="ERROR"/>
            <setHeader name="CamelHttpResponseCode">
                <constant>500</constant>
            </setHeader>
        </onException>


        <!--<interceptFrom uri="servlet:/user*">
            <bean ref="auditLogger" method="headerChecker"/>
            <log message="interceptor" loggingLevel="DEBUG"/>
            <setHeader name="abc">
                <constant>Abc</constant>
            </setHeader>
        </interceptFrom>
        -->

        <restConfiguration bindingMode="auto" component="servlet">
            <endpointProperty key="servletName" value="RestServiceCamelServlet"/>
        </restConfiguration>

        <rest path="/users" id="fetch-all-users">
            <get>
                <route>
                    <setBody>
                        <constant>All Users</constant>
                    </setBody>
                </route>
            </get>
        </rest>

        <rest path="/user">
            <get id="fetch-user-details-userid">
                <to uri="direct:fetch-user-details"/>
            </get>
            <post id="create-user">
                <to uri="direct:register"/>
            </post>
            <put id="update-user-details">
                <to uri="direct:update-user-details"/>
            </put>
            <delete id="delete-user-details">
                <to uri="direct:delete-user"/>
            </delete>
        </rest>

        <rest path="/login">
            <post id="login-user">
                <to uri="direct:login"/>
            </post>
            <delete id="logout-user">
                <to uri="direct:logout"/>
            </delete>
        </rest>

    </camelContext>

</beans>